/*
@title: Good Golf
@author: Alakh
@tags: ['Golf']
@addedOn: 2024-07-11
*/

const player = "p";
const ball = "b";
const hole = "g";
const obstruction = "w";
const grass = "l";
const bounds = "e";

//legend
setLegend(
  [ player, bitmap`
4444400044444444
4444400044444444
4444400044444444
4444400044444444
4444400044444444
4444400044444444
4444400044444444
4444400044444444
4444400044444444
4444400000004444
4444400000004444
4444400000004444
4444444444444444
4444444444444444
4444444444444444
4444444444444444`],
  [ ball, bitmap`
4444444444444444
4444444444444444
4444444444444444
4444440004444444
4444002220044444
4440222222204444
4440222222204444
4402222222220444
4402222222220444
4402222222220444
4440222222204444
4440222222204444
4444002220044444
4444440004444444
4444444444444444
4444444444444444`],
  [ hole, bitmap`
4444444444444444
4444444444444444
4444444444444444
4444444444444444
4440000000044444
4440000000044444
4440000000044444
4440000000044444
4440000000044444
4440000000044444
4440000000044444
4440000000044444
4444444444444444
4444444444444444
4444444444444444
4444444444444444`],
  [ obstruction, bitmap`
4444444L44444444
4444444L44444444
4444444L44444444
4444444L44444444
4444444L44444444
4444444L44444444
4444444L44444444
4444444L44444444
4444444L44444444
4444444L44444444
4444444L44444444
4444444L44444444
4444444L44444444
4444444L44444444
4444444L44444444
4444444L44444444`],
  [ grass, bitmap`
4444444444444444
4444444444444444
4444444444444444
4444444444444444
4444444444444444
4444444444444444
4444444444444444
4444444444444444
4444444444444444
4444444444444444
4444444444444444
4444444444444444
4444444444444444
4444444444444444
4444444444444444
4444444444444444`],
  [ bounds, bitmap`
4444444444444444
4444444444444444
4444444444444444
4444444444444444
4444444444444444
4444444444444444
4444444444444444
4444444444444444
4444444444444444
4444444444444444
4444444444444444
4444444444444444
4444444444444444
4444444444444444
4444444444444444
4444444444444444`]
);


// levels
let level = 0; 
const levels = [
  map`
llllllgl
llllllll
lpblllll
llllllll
llllllll`,
  map`
elllllleeeelll
elllwlllllllll
elllwllwlwlwll
ellllllwlllwll
epblllllllllgl
elllwllllwlwll
elllwllwllllle
elllwllwlwllle
eeeeeeeeeeeeee`,
  map`
eeeeeeeeeeeeeeee
elllwlwlwlllwlle
elllwlwlllllwlle
elllwlllllwlwlle
elllwlwlwlllllge
epblwlwlwlllwlle
elllwlwlwlllwlle
elllllllwlllwlle
elllwlllwlllwlle
eeeeeeeeeeeeeeee`,
  map`
eeeeeeeeeeeeeeeeeee
ellllwlwlwlwlwlwlle
elpblllwlllwlllllle
ellllllllwlllllwlle
ellllwlwlwlwlwlwlle
ellllwlllllwlwlwlle
ellllwlwlwlwlwlwlle
ellllllllwlwlwlllge
ellllwlllllllllwlle
ellllwlwlwlllwlwlle
eeeeeeeeeeeeeeeeeee`,
  map`
eeeeeeeeeeeeeeeeeee
ellllwlwlwlwlwlwlle
elpblllwlllwlllllle
ellllllllwlllllwlle
ellllwlwlwlwlwlwlle
ellllwlllllwlwlwlle
ellllwlwlwlwlwlwlle
ellllllllwlwlwlllge
ellllwlllllllllwlle
ellllwlwlwlllwlwlle
eeeeeeeeeeeeeeeeeee`,
  map`
eeeeeeeeeeeeeeeeee
elllwlllllwlllwlle
elllllwlwlllllllle
elllwlwlllllwlwlle
epblllllwlwlwlwlle
elllwlwlwlwlllllle
elllllwlwlllwlllge
elllllllllwlwlwlle
elllwlwlllwlllwlle
eeeeeeeeeeeeeeeeee`,
];

// tunes
const tunes = {
  background: tune`
405.4054054054054: C5/405.4054054054054 + D5/405.4054054054054,
405.4054054054054: C5~405.4054054054054 + D5~405.4054054054054,
405.4054054054054: C5^405.4054054054054 + D5/405.4054054054054,
405.4054054054054: C5-405.4054054054054 + D5^405.4054054054054,
405.4054054054054: C5/405.4054054054054 + D5/405.4054054054054,
405.4054054054054: C5~405.4054054054054 + D5~405.4054054054054,
405.4054054054054: C5^405.4054054054054 + D5/405.4054054054054,
405.4054054054054: C5-405.4054054054054 + D5^405.4054054054054,
405.4054054054054: C5/405.4054054054054 + D5/405.4054054054054,
405.4054054054054: C5~405.4054054054054 + D5~405.4054054054054,
405.4054054054054: C5^405.4054054054054 + D5/405.4054054054054,
405.4054054054054: C5-405.4054054054054 + D5^405.4054054054054,
405.4054054054054: C5/405.4054054054054 + D5/405.4054054054054,
405.4054054054054: C5~405.4054054054054 + D5~405.4054054054054,
405.4054054054054: C5^405.4054054054054 + D5/405.4054054054054,
405.4054054054054: C5-405.4054054054054 + D5^405.4054054054054,
405.4054054054054: C5/405.4054054054054 + D5/405.4054054054054,
405.4054054054054: C5~405.4054054054054 + D5~405.4054054054054,
405.4054054054054: C5^405.4054054054054 + D5/405.4054054054054,
405.4054054054054: C5-405.4054054054054 + D5^405.4054054054054,
405.4054054054054: C5/405.4054054054054 + D5/405.4054054054054,
405.4054054054054: C5~405.4054054054054 + D5~405.4054054054054,
405.4054054054054: C5^405.4054054054054 + D5/405.4054054054054,
405.4054054054054: C5-405.4054054054054 + D5^405.4054054054054,
405.4054054054054: C5/405.4054054054054 + D5/405.4054054054054,
405.4054054054054: C5~405.4054054054054 + D5~405.4054054054054,
405.4054054054054: C5^405.4054054054054 + D5/405.4054054054054,
405.4054054054054: C5-405.4054054054054 + D5^405.4054054054054,
405.4054054054054: C5/405.4054054054054 + D5/405.4054054054054,
405.4054054054054: C5~405.4054054054054 + D5~405.4054054054054,
405.4054054054054: C5^405.4054054054054 + D5/405.4054054054054,
405.4054054054054: C5-405.4054054054054 + D5^405.4054054054054`,
  reset: tune`
149.2537313432836,
149.2537313432836: F5^149.2537313432836 + E5^149.2537313432836 + D5^149.2537313432836 + C5^149.2537313432836 + B4^149.2537313432836,
149.2537313432836,
149.2537313432836: G4^149.2537313432836 + F4^149.2537313432836 + E4^149.2537313432836 + D4^149.2537313432836,
149.2537313432836: G4/149.2537313432836 + F4/149.2537313432836 + E4/149.2537313432836 + D4/149.2537313432836,
4029.850746268657`,
  start: tune`
218.97810218978103: B4-218.97810218978103 + A4-218.97810218978103 + G4-218.97810218978103 + F4-218.97810218978103 + A5-218.97810218978103,
218.97810218978103: B4-218.97810218978103 + C5~218.97810218978103 + A5~218.97810218978103 + G5~218.97810218978103 + F5~218.97810218978103,
218.97810218978103: D4-218.97810218978103 + E4-218.97810218978103 + F4-218.97810218978103 + G4-218.97810218978103 + A4-218.97810218978103,
218.97810218978103: C4-218.97810218978103 + G5^218.97810218978103 + G4-218.97810218978103,
218.97810218978103: A5-218.97810218978103 + G5-218.97810218978103 + F5-218.97810218978103 + C5~218.97810218978103 + G4-218.97810218978103,
218.97810218978103: B5-218.97810218978103 + F5~218.97810218978103 + G5~218.97810218978103 + C4^218.97810218978103,
218.97810218978103: A5~218.97810218978103 + C4^218.97810218978103,
218.97810218978103: D4-218.97810218978103 + E4-218.97810218978103 + F4-218.97810218978103 + G4-218.97810218978103 + A4-218.97810218978103,
218.97810218978103: B4-218.97810218978103 + C4^218.97810218978103 + G4-218.97810218978103,
218.97810218978103: E5-218.97810218978103 + C5~218.97810218978103 + G4-218.97810218978103,
218.97810218978103: A5-218.97810218978103 + G5-218.97810218978103 + F5-218.97810218978103,
218.97810218978103: G5~218.97810218978103 + F5~218.97810218978103,
218.97810218978103: D4-218.97810218978103 + C5~218.97810218978103 + A5~218.97810218978103,
218.97810218978103: E4-218.97810218978103 + F4-218.97810218978103 + G4-218.97810218978103 + A4-218.97810218978103 + B4-218.97810218978103,
218.97810218978103: D4^218.97810218978103 + G4-218.97810218978103,
218.97810218978103: G5-218.97810218978103 + F5-218.97810218978103 + E5-218.97810218978103 + D5-218.97810218978103 + C4^218.97810218978103,
218.97810218978103: A5-218.97810218978103 + C5~218.97810218978103 + G5~218.97810218978103 + F5~218.97810218978103,
218.97810218978103: A5~218.97810218978103,
218.97810218978103: E4-218.97810218978103,
218.97810218978103: E4-218.97810218978103 + F4-218.97810218978103 + G4-218.97810218978103 + A4-218.97810218978103 + B4-218.97810218978103,
218.97810218978103: E5-218.97810218978103 + F5-218.97810218978103 + G5-218.97810218978103 + C5~218.97810218978103 + D4^218.97810218978103,
218.97810218978103: A5-218.97810218978103 + B5-218.97810218978103 + G5-218.97810218978103 + F5-218.97810218978103 + C4^218.97810218978103,
218.97810218978103: F5~218.97810218978103 + G5~218.97810218978103 + D4^218.97810218978103,
218.97810218978103: F5-218.97810218978103 + A5~218.97810218978103,
218.97810218978103: C5~218.97810218978103 + D4^218.97810218978103,
218.97810218978103: E4-218.97810218978103 + F4-218.97810218978103 + G4-218.97810218978103 + A4-218.97810218978103 + B4-218.97810218978103,
218.97810218978103: E5-218.97810218978103 + C4^218.97810218978103 + G4-218.97810218978103,
218.97810218978103: B5-218.97810218978103 + A5-218.97810218978103 + G5-218.97810218978103 + F5-218.97810218978103 + E5-218.97810218978103,
218.97810218978103: F5~218.97810218978103 + G5~218.97810218978103,
218.97810218978103: C5~218.97810218978103 + A5~218.97810218978103 + D4^218.97810218978103,
218.97810218978103: E4-218.97810218978103 + F4-218.97810218978103 + G4-218.97810218978103 + A4-218.97810218978103 + B4-218.97810218978103,
218.97810218978103: C5-218.97810218978103 + G4-218.97810218978103`,
};

// plays start tune
playTune(tunes.start)

// default background
setBackground(grass)

const currentLevel = levels[level];

// text
setMap(currentLevel);
addText("Good Golf", { y: 2, color: color`2` })
addText("Dodge the Obstruction", { y: 4, color: color`8` });
addText("And put the ball in the hole", { y: 5, color: color`8` });
addText("use w a s d to move", { y: 10, color: color`9` });
addText("Press j to reset", { y: 11, color: color`9` });
afterInput(() => {
  clearText();
  const numberCovered = tilesWith(player, ball).length;
})

// mech 1 - timer
let timer = 200;

// Timer display
let timerText = addText("", { x: 1, y: 1, color: color`1` });

// timer updater
setInterval(() => {
    if (timerText) {
        timerText.remove();
    }
    timerText = addText(`Time: ${timer}`, { x: 5, y: 0, color: color`9` });
    
    if (timer <= 0) {
        addText("Time's up! You lose", { y: 4, color: color`3` });
        playTune(tunes.reset);
    }
    
    timer--;
}, 1000); 

// goalpost modifier
afterInput(() => {
    const targetNumber = tilesWith(hole).length;
    const numberCovered = tilesWith(hole, ball).length;
  
    // goalpost checker
    if (numberCovered === targetNumber && timer > 0) {
        level = level + 1;
        const currentLevel = levels[level];
  
        // Game completion check
        if (currentLevel !== undefined) {
            setMap(currentLevel);
        }
    }
});

// makes sprite solid
setSolids([ player, ball, obstruction, bounds]); 

// movement of player
onInput("s", () => {
  getFirst(player).y += 1; 
  });

onInput("d", () => {
  getFirst(player).x += 1;
  });

onInput("w", () => {
    getFirst(player).y -= 1;
    });

onInput("a", () => {
    getFirst(player).x -= 1;
    });

onInput("s", () => {
    getFirst(player).y += 1;
    });



// reset button
onInput("j", () => {
  const currentLevel = levels[level];
  playTune(tunes.reset)
if (currentLevel !== undefined) {
    clearText("");
    setMap(currentLevel);
 }
});

// for ball
setPushables({
  [player]: [ ball ],
});

// goal func.ddddvdsdagdav
afterInput(() => {
  const targetNumber = tilesWith(hole).length;
  const numberCovered = tilesWith(hole, ball).length;

  // goal text
  if (numberCovered === targetNumber) {
   addText("Goal!", { y: 4, color: color`2` });
   playTune(tunes.reset)
    level = level + 1;
    const currentLevel = levels[level];

    // game end text
    if (currentLevel !== undefined) {
      setMap(currentLevel);
    } else {
      addText("Game Over!", { y: 4, color: color`3` });
      addText("Thanks for playing", { y: 6, color: color`3` });
      playTune(tunes.background, Infinity)
    }
  }
});
